let canvas;
let keyboard = new Keyboard();
let soundtrack_audio;
let mute_grn;
let play_grn;
let audioMute;
let audioPlay;
let resizeButton;
let leftButton;
let rightButton;
let jumpButton;
let attackButton;
let menuList;
let menuOpened = false;

function init(){
    canvas = document.getElementById('canvas');
    world = new World(canvas, keyboard);
}

function startGame(){
    soundtrack_audio = new Audio('./audio/morenita.mp3');
    soundtrack_audio.play();
    document.getElementsByClassName('game')[0].classList.remove('d-none');
    document.getElementsByClassName('start-site-body')[0].classList.add('d-none');
    document.getElementsByClassName('title-box')[0].classList.remove('d-none');
    document.getElementsByClassName('impressum')[0].classList.remove('d-none');
    document.getElementsByClassName('click-icons')[0].classList.remove('d-none');
    init();
    touchScreenComandBar(); 
}

document.addEventListener('keydown', (e) => {
    
    if(e.keyCode == 32){
        keyboard.SPACE = true;
        e.preventDefault();
    }

    if(e.keyCode == 40){
        keyboard.DOWN = true;
        e.preventDefault();
    }

    if(e.keyCode == 39){
        keyboard.RIGHT = true;
        e.preventDefault();
    }

    if(e.keyCode == 37){
        keyboard.LEFT = true;
        e.preventDefault();
    }

    if(e.keyCode == 38){
        keyboard.UP = true;
        e.preventDefault();
    } 
});

document.addEventListener('keyup', (e) => {
    if(e.keyCode == 32){
        keyboard.SPACE = false;
    }

    if(e.keyCode == 40){
        keyboard.DOWN = false;
    }

    if(e.keyCode == 39){
        keyboard.RIGHT = false;
    }

    if(e.keyCode == 37){
        keyboard.LEFT = false;
    }

    if(e.keyCode == 38){
        keyboard.UP = false;
    }
});

function touchScreenComandBar(){

    translateButtonToVariable()

    playMusicByPCScreen();
    changeToFullscreenCondition();
    eventPressTouchScreen();
    eventReleaseTouchScreen();
    openMenuKeysDescription()
}

function translateButtonToVariable(){
    mute_grn = document.getElementById('mute_grn');
    play_grn = document.getElementById('play_grn');
    audioMute = document.getElementById('audioMute');
    audioPlay = document.getElementById('audioPlay');
    resizeButton = document.getElementById('resizeButton');
    leftButton = document.getElementById('leftButton');
    rightButton = document.getElementById('rightButton');
    jumpButton = document.getElementById('jumpButton');
    attackButton = document.getElementById('attackButton');
    menuList = document.getElementById('menu-list');
    
}

function openMenuKeysDescription(){
    
    menuList.addEventListener('touchstart', (e)=>{
        e.preventDefault();
        if(menuOpened == false){
            document.getElementsByClassName('game-menu')[0].classList.remove('d-none');
            menuOpened = true;
        } else {
            document.getElementsByClassName('game-menu')[0].classList.add('d-none');
            menuOpened = false;
        }
    })
    menuList.addEventListener('mousedown', (e)=>{
        e.preventDefault();
        if(menuOpened == false){
            document.getElementsByClassName('game-menu')[0].classList.remove('d-none');
            menuOpened = true;
        } else {
            document.getElementsByClassName('game-menu')[0].classList.add('d-none');
            menuOpened = false;
        }
    })
   
}

function playMusicByPCScreen(){
    mute_grn.addEventListener('touchstart', (e)=>{
        e.preventDefault();
        soundtrack_audio.pause();
        mute_grn.classList.add('d-none');
        play_grn.classList.remove('d-none');
    })

    play_grn.addEventListener('touchstart', (e) =>{
        e.preventDefault();
        soundtrack_audio.play();
        mute_grn.classList.remove('d-none');
        play_grn.classList.add('d-none');
    })
    mute_grn.addEventListener('mousedown', (e)=>{
        e.preventDefault();
        soundtrack_audio.pause();
        mute_grn.classList.add('d-none');
        play_grn.classList.remove('d-none');
    })

    play_grn.addEventListener('mousedown', (e) =>{
        e.preventDefault();
        soundtrack_audio.play();
        mute_grn.classList.remove('d-none');
        play_grn.classList.add('d-none');
    })
}

function changeToFullscreenCondition(){
    resizeButton.addEventListener('touchstart', (e)=>{
        e.preventDefault();
        canvas.requestFullscreen();
    })
    resizeButton.addEventListener('mousedown', (e)=>{
        e.preventDefault();
        canvas.requestFullscreen();
    })
}

function eventPressTouchScreen(){
    leftButton.addEventListener('touchstart', (e)=>{
        e.preventDefault();
        keyboard.LEFT = true;
    });
    rightButton.addEventListener('touchstart', (e)=>{
        e.preventDefault();
        keyboard.RIGHT = true;
    });
    jumpButton.addEventListener('touchstart', (e)=>{
        e.preventDefault();
        keyboard.UP = true;
    });
    attackButton.addEventListener('touchstart', (e)=>{
        e.preventDefault();
        keyboard.SPACE = true;
    });
}

function eventReleaseTouchScreen(){
    leftButton.addEventListener('touchend', (e)=>{
        e.preventDefault();
        keyboard.LEFT = false;
    });
    rightButton.addEventListener('touchend', (e)=>{
        e.preventDefault();
        keyboard.RIGHT = false;
    });
    jumpButton.addEventListener('touchend', (e)=>{
        e.preventDefault();
        keyboard.UP = false;
    });
    attackButton.addEventListener('touchend', (e)=>{
        e.preventDefault();
        keyboard.SPACE = false;
    });
}

function alertKeyboard(){
    alert('For this action use the keyboard');
}

